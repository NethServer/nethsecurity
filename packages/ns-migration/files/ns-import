#!/bin/sh

function usage {
    echo "$0 <exported_archive>"
    exit 1
}

if [ -z "$1" ]; then
    usage    
fi

if [ ! -f $1 ]; then
    echo "No such file or directory: '$1'"
    exit 1
fi

# Prepare target directories and explode archive
tmp_dir=$(mktemp -d)
work_dir=$(pwd)
archive="$work_dir/$1"
cd $tmp_dir
tar xvzf "$archive"
cd $work_dir

# Execute all scripts
for f in $(find /usr/share/firewall-import/ -type f)
do
    $f "$tmp_dir/export"
done

rm -rf $tmp_dir

# Restart services
service network restart
service firewall restart
service dnsmasq restart
